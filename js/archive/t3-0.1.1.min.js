/*! T3 v0.1.1 *//**
 * The one global object for Box JavaScript.
 * @namespace
 */window.Box={},Box.EventTarget=function(){"use strict";var e=function(){this._handlers={}};return e.prototype={constructor:e,on:function(e,t){typeof this._handlers[e]=="undefined"&&(this._handlers[e]=[]),this._handlers[e].push(t)},fire:function(e,t){var n,r,i,s={type:e,data:t};n=this._handlers[s.type];if(n instanceof Array)for(r=0,i=n.length;r<i;r++)n[r].call(this,s)},off:function(e,t){var n=this._handlers[e],r,i;if(n instanceof Array)for(r=0,i=n.length;r<i;r++)if(n[r]===t){n.splice(r,1);break}}},e}(),Box.Context=function(){"use strict";var e=function(e,t){this.application=e,this.element=t};return e.prototype={broadcast:function(e,t){this.application.broadcast(e,t)},getService:function(e){return this.application.getService(e)},getConfig:function(e){return this.application.getModuleConfig(this.element,e)},getGlobalConfig:function(e){return this.application.getGlobalConfig(e)},getElement:function(){return this.element}},e}(),Box.Application=function(){"use strict";function f(){t={},n={},r={},i={},s={};for(var e=0;e<o.length;e++)delete u[o[e]],delete Box.Context.prototype[o[e]];o=[]}function l(e,n){n?n.name=e+" - "+n.name:n=new Error(e);if(t.debug)throw n;u.fire("error",{message:e,exception:n})}function c(e,t){var n,r;for(n in e)r=e[n],typeof r=="function"&&(e[n]=function(e,n){return function(){try{return n.apply(this,arguments)}catch(r){l(t+"."+e+"()",r)}}}(n,r))}function h(e){var t=$(e).data("module");return t?t.split(" ")[0]:""}function p(e,t){typeof e[t]=="function"&&e[t].apply(e,Array.prototype.slice.call(arguments,2))}function d(e){var t=r[e];return t?(t.instance||(t.instance=t.creator(u)),t.instance):null}function v(e){var t,n,r,s=[],o;n=e.instance.behaviors||[];for(t=0;t<n.length;t++)"behaviorInstances"in e||(e.behaviorInstances={}),o=e.behaviorInstances,r=i[n[t]],r?(o[n[t]]||(o[n[t]]=r.creator(e.context)),s.push(o[n[t]])):l('Behavior "'+n[t]+'" not found');return s}function m(e){var t=$(e),n=t.is("[data-type]");while(!n&&t.length&&!t.hasClass("module"))t=t.parent(),n=t.is("[data-type]");return n?t[0]:null}function g(e,t,n){var r=function(e){var t=m(e.target),r=t?t.getAttribute("data-type"):"";for(var i=0;i<n.length;i++)n[i](e,t,r);return!0};return $(e).on(t,r),r}function y(e){var t,n,r,i,s,o=v(e);for(t=0;t<a.length;t++){s=[],r=a[t],i="on"+r,e.instance[i]&&s.push($.proxy(e.instance[i],e.instance));for(n=0;n<o.length;n++)o[n][i]&&s.push($.proxy(o[n][i],o[n]));s.length&&(e.eventHandlers[r]=g(e.element,r,s))}}function b(e){for(var t in e.eventHandlers)$(e.element).off(t,e.eventHandlers[t]);e.eventHandlers={}}function w(e){return s[e.id]}var e=".module",t={},n={},r={},i={},s={},o=[],u=new Box.EventTarget,a=["click","mouseover","mouseout","mousedown","mouseup","mouseenter","mouseleave","keydown","keyup","submit","change","contextmenu","dblclick"];return $.extend(u,{init:function(e){$.extend(t,e||{}),this.startAll(document.documentElement),this.fire("init")},destroy:function(){this.stopAll(document.documentElement),f()},isStarted:function(e){var t=w(e);return typeof t=="object"},start:function(e){var r=h(e),i=n[r],o,u,a;if(!i){l('Module type "'+r+'" is not defined.');return}if(!this.isStarted(e)){e.id||(e.id="mod-"+r+"-"+i.counter),i.counter++,u=new Box.Context(this,e),a=i.creator(u),t.debug||c(a,r),o={moduleName:r,instance:a,context:u,element:e,eventHandlers:{}},y(o),s[e.id]=o,p(o.instance,"init");var f=v(o),d;for(var m=0,g=f.length;m<g;m++)d=f[m],p(d,"init")}},stop:function(e){var r=w(e),i,o;if(!r){if(t.debug){l("Unable to stop module associated with element: "+e.id);return}}else{i=r.moduleName,o=n[i],b(r);var u=v(r),a;for(var f=u.length-1;f>=0;f--)a=u[f],p(a,"destroy");p(r.instance,"destroy"),delete s[e.id]}},startAll:function(t){var n=this,r=$(t);r.find(e).each(function(e,t){n.start(t)})},stopAll:function(t){var n=this,r=$(t);r.find(e).each(function(e,t){n.stop(t)})},addModule:function(e,t){n[e]={creator:t,counter:1}},getModuleConfig:function(e,t){var n=w(e),r;return n?(n.config||(r=$(e).find('script[type="text/x-config"]')[0],r&&(n.config=$.parseJSON(r.text))),n.config?typeof t=="undefined"?n.config:t in n.config?n.config[t]:null:null):null},addService:function(e,t,n){n=n||{},r[e]={creator:t,instance:null};if(n.exports)for(var i=0;i<n.exports.length;i++){var s=n.exports[i],u=function(t){return function(){var n=d(e);return n[t].apply(n,arguments)}}(s);if(s in this){l(s+" already exists on Application object");return}this[s]=u;if(s in Box.Context.prototype){l(s+" already exists on Context prototype");return}Box.Context.prototype[s]=u,o.push(s)}},getService:d,addBehavior:function(e,t){i[e]={creator:t,instance:null}},broadcast:function(e,t){var n,r,i,o,u,a;for(r in s){a=[],i=s[r],$.inArray(e,i.instance.messages||[])!==-1&&a.push($.proxy(i.instance.onmessage,i.instance)),u=v(i);for(n=0;n<u.length;n++)o=u[n],$.inArray(e,o.messages||[])!==-1&&a.push($.proxy(o.onmessage,o));for(n=0;n<a.length;n++)a[n](e,t)}},getGlobalConfig:function(e){return typeof e=="undefined"?t:e in t?t[e]:null}})}();