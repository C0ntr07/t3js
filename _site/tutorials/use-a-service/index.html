<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>T3 Javascript Framework - Tutorials</title>

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" href="/pages/Box/T3/css/base.css">
        <link rel="stylesheet" href="/pages/Box/T3/css/skeleton.css">
        <link rel="stylesheet" href="/pages/Box/T3/css/layout.css">

        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/pages/Box/T3/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/pages/Box/T3/css/main.css">

    </head>


    <body>

        <header class="header">
    <div class="container">
        <div class="sixteen columns">
            <nav class="header-nav">
                <ul>
    <li class="">
        <a href="/pages/Box/T3/">overview</a>
    </li>
    <li class="">
        <a href="/pages/Box/T3/documentation">documentation</a>
    </li>
    <li class="current">
        <a href="/pages/Box/T3/tutorials">tutorials</a>
    </li>
    <li class="">
        <a href="/pages/Box/T3/download">download</a>
    </li>
    <li class="">
        <a href="/pages/Box/T3/examples">examples</a>
    </li>
</ul>
            </nav>
        </div>
    </div>
</header>
<div class="header-spacer"></div>


        <div class="content container">
            <div class="three columns">
                <div>
  <aside>
    <h4><a href="/pages/Box/T3/tutorials/">Tutorial</a></h4>
    <ul>
        <li>Initial Setup</li>
        <li>Create a Module</li>
        <li>Passing Messages</li>
        <li>Event Handlers</li>
        <li>Use a Service</li>
        <li>Add Widgets</li>
        <li>Firing Custom Events</li>
        <li>Use Custom Data</li>
        <li>Add a Behavior</li>
    </ul>
  </aside>
</div>
            </div>
            <div class="tutorial twelve columns offset-by-one">
                <h1>Use a Service</h1>

<p>We&#39;ve covered a lot of ground, we can make modules that can communicate with each other as well as the user. Since modules exist completely encapsulated on the page, one of the pains is code reuse between the module files. Don&#39;t worry, T3 has got this covered. In T3 we can pack bundles of functions together in <em>services</em>, these services can be injected through the <code>Application.getService</code> method. In this chapter we&#39;ll create a service and use it in our shiny new modules.</p>

<p>Let&#39;s talk about our application. We really can&#39;t have just these 3 memes be all we can provide to our users, the range of human emotion is more vast than this. We should be able to fetch meme images from the server as well as the handy images we have stored locally in the application. For this we will create a service that is responsible for fetching remote and local meme images.</p>

<h2>Creating a Service</h2>

<p>The creation of a service is the same as the creation of a module, we can use Yeoman for this, except this time we&#39;ll use the choose the <code>Service</code> option. Let&#39;s name this one <code>meme-fetcher</code>. This should look pretty similar to modules, we return the public interface and register a name with the returned object.</p>

<p>Let&#39;s define the public API for this service, we want users of the service to be able to get the available meme images and the service abstracts the returned collection (whether it is remote or local). Let&#39;s name the method <code>fetchMemes</code> that will return an object mapping meme name to an image URI and <code>fetchMemesByName</code> that will get a specific image URI. For the purpose of this exercise we will stub out the remote/local nature of the images.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">Application</span><span class="p">.</span><span class="nx">addService</span><span class="p">(</span><span class="s1">&#39;meme-fetcher&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">LOCAL_IMAGE_PATHS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;10-guy&#39;</span><span class="o">:</span> <span class="s1">&#39;img/full/10-guy.jpg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;bad-time&#39;</span><span class="o">:</span> <span class="s1">&#39;img/full/bad-time.jpg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;not-sure-fry&#39;</span><span class="o">:</span> <span class="s1">&#39;img/full/not-sure-fry.jpg&#39;</span>
  <span class="p">};</span>

  <span class="kd">function</span> <span class="nx">localFetch</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">LOCAL_IMAGE_PATHS</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">serverFetch</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// AJAX off and grab the images</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">fetchMemes</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">offline</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// omg we&#39;re offline</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">offline</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">localFetch</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">serverFetch</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">},</span>

    <span class="nx">fetchMemeByName</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">fetchMemes</span><span class="p">()[</span><span class="nx">name</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span>
</code></pre></div>

<p>Users will be able to call <code>Application.getService(&#39;meme-fetcher&#39;)</code> from within their modules and make use of the available functions. This type of code reuse and abstraction is critical in building modules that are clean and have one responsibility (handle user/inter-module communication).</p>

<p>From the last exercise we added functionality to update the image source URI when a thumbnail was clicked, there was a point where the image was clicked and either the image URI or the meme name had to be broadcasted. Find where in your implementation the construction of the URI happens and let&#39;s exchange that for using the service instead.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">Application</span><span class="p">.</span><span class="nx">addModule</span><span class="p">(</span><span class="s1">&#39;meme-generator&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">imageEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.meme-image&#39;</span><span class="p">);</span>

  <span class="p">...</span>

  <span class="nx">onmessage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">switch</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>

        <span class="p">...</span>

        <span class="k">case</span> <span class="s1">&#39;thumbnailclicked&#39;</span><span class="o">:</span>
          <span class="kd">var</span> <span class="nx">memeFetcher</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">getService</span><span class="p">(</span><span class="s1">&#39;meme-fetcher&#39;</span><span class="p">),</span>
              <span class="nx">srcPath</span>  <span class="o">=</span> <span class="nx">memeFetcher</span><span class="p">.</span><span class="nx">fetchMemeByName</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">memeName</span><span class="p">);</span>
          <span class="nx">imageEl</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">srcPath</span><span class="p">;</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="c1">// no default</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span>
</code></pre></div>


                
                  <a class="prev" href="/pages/Box/T3/tutorials/event-handlers">‚Üê Event Handlers</a>
                

                
            </div>
        </div>

        <footer class="footer">
    <div class="container">
        <div class="sixteen columns">
            <p>&copy; 2014 Box.com, Inc.</p>
        </div>
    </div>
</footer>


    </body>

</html>

