<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>T3 Javascript Framework - Tutorials</title>

        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" href="/pages/Box/T3/css/base.css">
        <link rel="stylesheet" href="/pages/Box/T3/css/skeleton.css">
        <link rel="stylesheet" href="/pages/Box/T3/css/layout.css">

        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/pages/Box/T3/css/syntax.css">

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/pages/Box/T3/css/main.css">

    </head>


    <body>

        <header class="header">
    <div class="container">
        <div class="sixteen columns">
            <nav class="header-nav">
                <ul>
    <li class="">
        <a href="/pages/Box/T3/">overview</a>
    </li>
    <li class="">
        <a href="/pages/Box/T3/documentation">documentation</a>
    </li>
    <li class="current">
        <a href="/pages/Box/T3/tutorials">tutorials</a>
    </li>
    <li class="">
        <a href="/pages/Box/T3/download">download</a>
    </li>
    <li class="">
        <a href="/pages/Box/T3/examples">examples</a>
    </li>
</ul>
            </nav>
        </div>
    </div>
</header>
<div class="header-spacer"></div>


        <div class="content container">
            <div class="three columns">
                <div>
  <aside>
    <h4><a href="/pages/Box/T3/tutorials/">Tutorial</a></h4>
    <ul>
        <li>Initial Setup</li>
        <li>Create a Module</li>
        <li>Passing Messages</li>
        <li>Event Handlers</li>
        <li>Use a Service</li>
        <li>Add Widgets</li>
        <li>Firing Custom Events</li>
        <li>Use Custom Data</li>
        <li>Add a Behavior</li>
    </ul>
  </aside>
</div>
            </div>
            <div class="tutorial twelve columns offset-by-one">
                <h1>Passing Messages</h1>

<p>Now that we have all of our encapsulated modules on that page, we can get our Javascript in there to do the job of creating memes. There&#39;s one problem: how does the <code>meme-menu</code> module communicate with the <code>meme-generator</code> module? The menu is handling the input values that need to update the overlay text on the image. This type of communication is handled by T3 and it is known as <em>messages</em>.</p>

<p>Similar to a publisher-subscriber model, T3 components are able to use the global <code>Application.broadcast</code> method to send out messages to anyone who is listening. This broadcast can be captured by the modules <code>onmessage</code> method. By using the <code>messages</code> array on the public interface, the module will be able to explicitly defined which messages it is listening to.</p>

<h2>Using Messages</h2>

<p>Let&#39;s use messages in our application. Essentially what we need to do is pass a message from the <code>meme-menu</code> module that will update the <code>meme-generator</code> module. We can have the modules agree that the message to update the text will be called <code>memetextchanged</code>. The second parameter to the <code>Application.broadcast</code> method is an object that will be sent to listeners of the message, this will contain the text and which text field needs to be updated. As a first check let&#39;s make the <code>meme-menu</code> broadcast this message with it is initialized:</p>

<div class="highlight"><pre><code class="javascript"><span class="c1">// In the meme-menu&#39;s returned interface, let&#39;s edit the init function</span>
<span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">Application</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="s1">&#39;memetextchanged&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">direction</span><span class="o">:</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span>
    <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;New meme text!&#39;</span>
  <span class="p">});</span>
<span class="p">};</span>
</code></pre></div>

<p>As the module broadcasts this message we need to update the code in the <code>meme-generator</code> module to listen for this message. We will need to do two things, first edit the messages we care about on the public interface of the module (the <code>messages</code> key) and then have the module react in the <code>onmessage</code> method for this message.</p>

<p>Adding the message to the public interface is as easy as appending a new entry into the <code>messages</code> key&#39;s array, it should look something like this:</p>

<div class="highlight"><pre><code class="javascript"><span class="k">return</span> <span class="p">{</span>
  <span class="nx">messages</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;memetextchanged&#39;</span><span class="p">],</span>
  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{...},</span>
  <span class="nx">onclick</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{...},</span>
  <span class="nx">onmessage</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{...}</span>
<span class="p">};</span>
</code></pre></div>

<p>In our <code>onmessage</code> method for the <code>meme-generator</code> module we can extract the text values from the message data and update the UI accordingly. Let&#39;s add a <code>switch</code> that will have <code>case</code>s for messages. In the private module scope (before the <code>return</code>) we can cache values that will be used again, let&#39;s store the elements for the text tags.</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">Application</span><span class="p">.</span><span class="nx">addModule</span><span class="p">(</span><span class="s1">&#39;meme-generator&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">topTextEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.top-container.meme-text&#39;</span><span class="p">),</span>
      <span class="nx">bottomTextEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;.bottom-container.meme-text&#39;</span><span class="p">);</span>
  <span class="p">...</span>
<span class="p">});</span>
</code></pre></div>

<p>We can use the private module-scoped variables in the public interface. Now let&#39;s add the message handling in the <code>meme-generator</code> module, we will <code>case</code> the <code>memetextchanged</code> message and depending on the <code>direction</code> of the label we will update the HTML accordingly. This should look like something below:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">onmessage</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s1">&#39;memetextchanged&#39;</span><span class="o">:</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">case</span> <span class="s1">&#39;top&#39;</span><span class="o">:</span>
            <span class="nx">topTextEl</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

          <span class="k">case</span> <span class="s1">&#39;bottom&#39;</span><span class="o">:</span>
            <span class="nx">bottomTextEl</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
          <span class="c1">// no default</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>Great! We should be able to update the text of the top and bottom label when the modules are initialized. But wait a minute, we can&#39;t even update the text from the input text fields. T3 handles this by having event handler methods on the public interface of the modules. Come with me and I&#39;ll show you!</p>


                
                  <a class="prev" href="/pages/Box/T3/tutorials/create-a-module">← Create a Module</a>
                

                
                  <a class="next" href="/pages/Box/T3/tutorials/event-handlers">Event Handlers →</a>
                
            </div>
        </div>

        <footer class="footer">
    <div class="container">
        <div class="sixteen columns">
            <p>&copy; 2014 Box.com, Inc.</p>
        </div>
    </div>
</footer>


    </body>

</html>

